%% 数据输入与预处理
data = [
145	26	6.624010432	12.69559399	1.962305237	48.07358698
145	31	6.751898152	12.78824112	1.965336242	47.79974643
145	36	6.895865006	12.86764716	1.951288749	46.84882046
145	41	7.045189401	12.92876483	1.930613009	45.87364148
145	46	7.204291145	13.00454022	1.903086074	44.67144221
145	51	7.350871038	13.06483327	1.881832301	43.66820278
145	56	7.530144026	13.11873068	1.838102829	42.28390675
145	61	7.673558208	13.20761052	1.821155384	41.32452564
145	66	7.844458563	13.27827481	1.782320978	40.0367078
145	71	8.00178472	13.35854479	1.75274654	38.87235345
283	26	6.909484409	12.75290664	1.923281159	83.41844422
283	31	7.060466268	12.82954158	1.905151673	81.49335252
283	36	7.204799133	12.90493017	1.890341977	79.68971027
283	41	7.345579947	12.99759398	1.878880811	77.96657523
283	46	7.503806545	13.06025538	1.855229575	75.94063089
283	51	7.659192209	13.1565957	1.836336422	73.95610504
283	56	7.831756308	13.21847826	1.802364085	71.73077762
283	61	7.973741575	13.31160557	1.792519299	70.25608668
283	66	8.137771131	13.39292054	1.764713537	68.26334555
283	71	8.293048239	13.47686626	1.743259477	66.46571798
425	26	7.148424188	12.82639824	1.885539489	116.5276581
425	31	7.29809988	12.91834168	1.865235608	113.4059211
425	36	7.451852396	12.990587	1.84356129	110.5230067
425	41	7.610635407	13.0587437	1.816803657	107.4811043
425	46	7.748243674	13.1575217	1.809692825	105.282644
425	51	7.914762352	13.21933795	1.777564975	102.181238
425	56	8.072627243	13.32440725	1.760455819	99.56698265
425	61	8.23503635	13.39430858	1.73545604	96.89117158
425	66	8.407312205	13.48126188	1.707211594	94.02670867
425	71	8.562938384	13.57789894	1.689628871	91.63931838
563	26	7.374325705	12.91872138	1.829541075	140.3796644
563	31	7.533844467	12.99800911	1.800989596	135.8735642
563	36	7.694730953	13.07259441	1.772764732	131.942515
563	41	7.842327602	13.15806938	1.758486493	128.9040819
563	46	8.004354194	13.23182613	1.732344069	125.2873481
563	51	8.154444441	13.32661634	1.717665107	122.3031702
563	56	8.324426465	13.40610984	1.691346563	118.8201458
563	61	8.481708574	13.48790149	1.671562873	115.6753013
563	66	8.647075661	13.57541819	1.649199394	112.5557711
563	71	8.815689117	13.66384635	1.624674178	109.3868649
703	26	7.626926145	13.05597422	1.762932013	158.7666918
703	31	7.77892389	13.13789864	1.741505282	153.9561994
703	36	7.935816555	13.21284605	1.718815546	149.7872
703	41	8.094601881	13.29209016	1.697415521	145.8788001
703	46	8.251399713	13.37083571	1.679166134	142.1442705
703	51	8.409009033	13.45115363	1.659085834	138.498648
703	56	8.576780875	13.53502815	1.636981113	134.7190944
703	61	8.732579043	13.6193722	1.616765287	131.5663437
703	66	8.902764545	13.71558747	1.592253132	127.5052817
703	71	9.062375846	13.80450295	1.572088109	124.0565856



];

I = data(:,1);      % 电流(mA)
T = data(:,2);      % 温度(℃)
params = data(:,3:6); % [a, b, c, A1, A2, A3, x2]

%% 模型构建系统
% 二次多项式模型：Y = β0 + β1*I + β2*T + β3*I² + β4*T² + β5*I*T
X = [ones(size(I)), I, T, I.^2, T.^2, I.*T];

param_names = {'a', 'b', 'A2', 'C'};
units = {'', '', '', ''}; % 参数单位

coefficients = cell(4,1);
predicted = zeros(size(params));
R2 = zeros(4,1);
RMSE = zeros(4,1);

%% 批量建模与评估
for i = 1:4
    % 最小二乘拟合
    coefficients{i} = X \ params(:,i);
    predicted(:,i) = X * coefficients{i};
    
    % 计算评估指标
    SSE = sum((params(:,i) - predicted(:,i)).^2);
    SST = sum((params(:,i) - mean(params(:,i))).^2);
    R2(i) = 1 - SSE/SST;
    RMSE(i) = sqrt(mean((params(:,i) - predicted(:,i)).^2));
    
    % 输出模型方程
    fprintf('\n参数 %s 的拟合方程:\n', param_names{i});
    fprintf('Y = %.5f + %.3e*I + %.5f*T + %.3e*I² + %.3e*T² + %.3e*I*T\n',...
            coefficients{i}(1), coefficients{i}(2), coefficients{i}(3),...
            coefficients{i}(4), coefficients{i}(5), coefficients{i}(6));
    fprintf('R² = %.4f, RMSE = %.4f %s\n', R2(i), RMSE(i), units{i});
end



%% 预测模块
% 示例：预测电流=300mA, 温度=40℃时的参数
I_pred = 140; T_pred = 65;
pred_X = [1, I_pred, T_pred, I_pred^2, T_pred^2, I_pred*T_pred];
pred_values = zeros(1,8);

fprintf('\n预测结果 @I=%dmA, T=%d℃:\n', I_pred, T_pred);
for i = 1:4
    pred_values(i) = pred_X * coefficients{i};
    fprintf('%s = %.5f %s\n', param_names{i}, pred_values(i), units{i});
end

I_pred = 280; T_pred = 65;
pred_X = [1, I_pred, T_pred, I_pred^2, T_pred^2, I_pred*T_pred];
pred_values = zeros(1,8);

fprintf('\n预测结果 @I=%dmA, T=%d℃:\n', I_pred, T_pred);
for i = 1:4
    pred_values(i) = pred_X * coefficients{i};
    fprintf('%s = %.5f %s\n', param_names{i}, pred_values(i), units{i});
end

I_pred = 420; T_pred = 65;
pred_X = [1, I_pred, T_pred, I_pred^2, T_pred^2, I_pred*T_pred];
pred_values = zeros(1,8);

fprintf('\n预测结果 @I=%dmA, T=%d℃:\n', I_pred, T_pred);
for i = 1:4
    pred_values(i) = pred_X * coefficients{i};
    fprintf('%s = %.5f %s\n', param_names{i}, pred_values(i), units{i});
end

I_pred = 560; T_pred = 65;
pred_X = [1, I_pred, T_pred, I_pred^2, T_pred^2, I_pred*T_pred];
pred_values = zeros(1,8);

fprintf('\n预测结果 @I=%dmA, T=%d℃:\n', I_pred, T_pred);
for i = 1:4
    pred_values(i) = pred_X * coefficients{i};
    fprintf('%s = %.5f %s\n', param_names{i}, pred_values(i), units{i});
end

I_pred = 700; T_pred = 65;
pred_X = [1, I_pred, T_pred, I_pred^2, T_pred^2, I_pred*T_pred];
pred_values = zeros(1,8);

fprintf('\n预测结果 @I=%dmA, T=%d℃:\n', I_pred, T_pred);
for i = 1:4
    pred_values(i) = pred_X * coefficients{i};
    fprintf('%s = %.5f %s\n', param_names{i}, pred_values(i), units{i});
end


